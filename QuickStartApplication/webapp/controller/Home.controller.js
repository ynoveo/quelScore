sap.ui.define([
	"sap/ui/core/mvc/Controller",
	"sap/m/Dialog",
	"sap/m/Button",
	"sap/m/Text",
	"sap/ui/model/json/JSONModel",
	'sap/m/MessageToast',
	"sap/m/Input",
	"sap/m/Label"
	
], function (Controller, Dialog, Button, Text, JSONModel, MessageToast, Input, Label) {
	"use strict";
	return Controller.extend("QuickStartApplication.controller.Home", {

		onInit: function () {
			//var oModel = new JSONModel();
//			oModel.loadData("https://www.quelscore.com/JSON_V2016.php?action=MATCHLIST&email=francois.dumont@ynoveo.fr&pass=azerty&phase=A");
			//oModel.loadData("../webapp/localService/connect.json");
			//this.getView().setModel(oModel);
		},
		/**
	*@memberOf QuickStartApplication.controller.View1
	*/
		onNavToPronostics: function () {
			//      This code was generated by the layout editor.
			sap.ui.core.UIComponent.getRouterFor(this).navTo("mesPronostics");
		},
		/**
	*@memberOf QuickStartApplication.controller.Home
	*/
		onNavToCompte: function () {
			//      This code was generated by the layout editor.
			sap.ui.core.UIComponent.getRouterFor(this).navTo("monCompte");
		},
		onNavToGroupe: function () {
			//      This code was generated by the layout editor.
			sap.ui.core.UIComponent.getRouterFor(this).navTo("mesGroupes");
		},
		onDialogPress: function () {
			var dialog = new Dialog({
				title: "R\xE8gles du jeu",
				type: "Message",
				content: new Text({ text: "5 points si vous trouvez le score exact, (apr\xE8s prolongation)\\n\\n3 points si vous avez la bonne diff\xE9rence de buts\\n\\n1 point si vous avez pronostiqu\xE9 le bon vainqueur (ou match nul)" }),
				beginButton: new Button({
					text: "OK",
					press: function () {
						dialog.close();
					}
				}),
				afterClose: function () {
					dialog.destroy();
				}
			});
			//to get access to the global model
			this.getView().addDependent(dialog);
			dialog.open();
		},
		/**
	*@memberOf QuickStartApplication.controller.Home
	*/

/* -----------------------------------------------------------------------
							Formulaire de connexion 
-------------------------------------------------------------------------*/
onLogon: function () {

//This code was generated by the layout editor.
			var oController = this;
			var dialog = new Dialog({
				title: "Connexion",
				type: "Message",
				content: [
//					new Text({ text: 'Entrer vos identifiants' }),
					new Label({ text: "Pseudo ou email" }),
					new Input("login"),
					new Label({ text: "Mot de passe" }),
					new Input("pass", {type: "Password"})
//					new TextArea('rejectDialogTextarea', {
//						width: '100%',
//						placeholder: 'Add note (optional)'
//					})
				],
				beginButton: new Button({
					text: "Connexion",
					press: function () {
						var sLogin = encodeURIComponent(sap.ui.getCore().byId("login").getValue());
						var sPass = encodeURIComponent(sap.ui.getCore().byId("pass").getValue());
						var sUrl = "http://www.quelscore.com/JSON_V2016.php?action=CONNECT&email=" + sLogin + "&pass=" + sPass;
						var otModel = new JSONModel();

						otModel.loadData(sUrl, {}, false);
						//otModel.loadData("../webapp/localService/connect.json", {}, false);
						oController.getView().setModel(otModel);
						//MessageToast.show("code retour = " + otModel.getProperty("/reponse/retcode"));
						if(otModel.getProperty("/reponse/retcode") === "0") {
							console.log(oController.byId("__button1"));
							oController.byId("__button1").setEnabled(false);
							oController.byId("__button1").setText("Connect√©");
						} else {
							MessageToast.show(otModel.getProperty("/reponse/retmsg"));
						}

						dialog.close();
					}
				}),
				endButton: new Button({
					text: 'Annuler',
					press: function () {
						dialog.close();
					}
				}),
				afterClose: function() {
					dialog.destroy();
				}
			});

			dialog.open();
		},


/* -----------------------------------------------------------------------
							Formulaire de connexion 
-------------------------------------------------------------------------*/
onSubscribe: function () {
//This code was generated by the layout editor.
var dialog = new Dialog({
				title: "Connexion",
				type: "Message",
				content: [
//					new Text({ text: 'Entrer vos identifiants' }),
					new Label({ text: 'E-mail' }),
					new Input('email',  {type: 'Email'}),
					new Label({ text: 'Pseudo' }),
					new Input('pseudo'),					
					new Label({ text: 'Mot de passe' }),					
					new Input('pass', {type: 'Password'}),
					new Label({ text: 'Confirmation du Mot de passe' }),					
					new Input('pass2', {type: 'Password'})
//					new TextArea('rejectDialogTextarea', {
//						width: '100%',
//						placeholder: 'Add note (optional)'
//					})
				],
				beginButton: new Button({
					text: 'Connexion',
					press: function () {
						var sLogin = encodeURIComponent(sap.ui.getCore().byId('login').getValue());
						var sPass = encodeURIComponent(sap.ui.getCore().byId('pass').getValue());
						var sUrl = "http://www.quelscore.com/JSON_V2016.php?action=CONNECT&email=" + sLogin + "&pass=" + sPass;
						var otModel = new JSONModel();
//						otModel.loadData(sUrl);
						otModel.loadData("../webapp/localService/connect.json", {},false);	
//						console.log(otModel);
						MessageToast.show("code retour = " + otModel.getProperty("/reponse/retcode"));
						dialog.close();
					}
				}),
				endButton: new Button({
					text: 'Annuler',
					press: function () {
						dialog.close();
					}
				}),
				afterClose: function() {
					dialog.destroy();
				}
			});

			dialog.open();
		},

		
		userInfo :  function (iduser) {
			try {
				if (iduser === "") {
					return "Connexion";
				} else {
					return iduser;
				}
			} catch (err) {
				return "Erreur";
			}
		}
	});
});